<button
  #triggerButton
  class="app-input flex cursor-pointer items-center justify-between text-left"
  cdkOverlayOrigin
  #trigger="cdkOverlayOrigin"
  [class.text-gray-400]="!selectedOption()"
  [disabled]="disabled()"
  (click)="toggle()"
  type="button"
  role="combobox"
  aria-haspopup="listbox"
  [attr.aria-expanded]="isOpen()"
  [attr.aria-controls]="isOpen() ? 'dropdown-listbox' : null"
>
  <span>{{ displayLabel() }}</span>
  <fa-icon
    class="text-gray-400 transition-transform duration-200"
    [class.rotate-180]="isOpen()"
    [icon]="faChevronDown"
  />
</button>

<ng-template
  cdkConnectedOverlay
  [cdkConnectedOverlayOrigin]="trigger"
  [cdkConnectedOverlayOpen]="isOpen()"
  [cdkConnectedOverlayPositions]="positions"
  [cdkConnectedOverlayMatchWidth]="true"
  (overlayOutsideClick)="close()"
>
  <ul
    #optionsList
    id="dropdown-listbox"
    class="z-50 box-border w-full max-h-60 overflow-auto rounded-lg border border-gray-200 bg-white py-1 shadow-lg"
    role="listbox"
  >
    @for (option of options(); track option.value; let i = $index) {
      <li
        class="cursor-pointer px-3 py-2 text-sm transition-colors duration-100"
        [class.bg-gray-100]="focusedIndex() === i"
        [class.font-medium]="option.value === value()"
        [class.text-blue-600]="option.value === value()"
        [attr.data-focused]="focusedIndex() === i"
        (click)="selectOption(option)"
        (keydown.enter)="selectOption(option)"
        (mouseenter)="onOptionMouseEnter(i)"
        role="option"
        tabindex="0"
        [attr.aria-selected]="option.value === value()"
      >
        @if (itemTemplate(); as template) {
          <ng-container
            [ngTemplateOutlet]="template"
            [ngTemplateOutletContext]="{ $implicit: option }"
          />
        } @else {
          {{ option.label }}
        }
      </li>
    }
  </ul>
</ng-template>
